!function(){"use strict";window.Type&&window.Type.registerNamespace?Type.registerNamespace("Office.Controls"):(void 0===window.Office&&(window.Office={},window.Office.namespace=!0),void 0===window.Office.Controls&&(window.Office.Controls={},window.Office.Controls.namespace=!0)),Office.Controls.PeopleAadDataProvider=function(e){this.authContext=e},Office.Controls.PeopleAadDataProvider.prototype={maxResult:50,authContext:null,lastErrorMessage:null,severHost:"localhost:3000",acquireToken:"00000002-0000-0000-c000-000000000000",apiVersion:"api-version=1.5",getPrincipals:function(e,r){var t=new XMLHttpRequest,o=this;t.open("GET","http://"+this.serverHost+"/users?keyword="+encodeURIComponent(e),!0),t.setRequestHeader("Content-Type","application/json"),t.withCredentials=!0,t.onabort=t.onerror=t.ontimeout=function(){o.lastErrorMessage="Search error. Try login first.",r("Error",null)},t.onload=function(){if(401===t.status)return o.lastErrorMessage="Unauthorized. You need login first.",void r("Unauthorized",null);200!==t.status&&(o.lastErrorMessage="Unknown error. Status code: "+t.statusCode,r("Unknown error",null));var e=JSON.parse(t.responseText),n=[];return void 0!==e["odata.error"]?(o.lastErrorMessage="Server error: "+e["odata.error"].message.value,void r(e["odata.error"],null)):(e.value.forEach(function(e){var r={};r.displayName=e.displayName,r.department=e.department,r.jobTitle=e.jobTitle,r.mail=e.mail,r.workPhone=e.telephoneNumber,r.mobile=e.mobile,r.office=e.physicalDeliveryOfficeName,r.sipAddress=e.userPrincipalName,r.alias=e.mailNickname,r.personId=e.objectId,n.push(r)}),n.length>o.maxResult&&(n=n.slice(0,o.maxResult)),void r(null,n))},t.send("")},getImageAsync:function(e,r){var t=new XMLHttpRequest,o=this;t.open("GET","http://"+this.serverHost+"/image?personId="+encodeURIComponent(e),!0),t.setRequestHeader("Content-Type","application/json"),t.withCredentials=!0,t.responseType="blob",t.onabort=t.onerror=t.ontimeout=function(){o.lastErrorMessage="Search error. Try login first.",r("Error",null)},t.onload=function(){if(401===t.status)return o.lastErrorMessage="Unauthorized. You need login first.",void r("Unauthorized",null);if(200!==t.status)return o.lastErrorMessage="Unknown error. Status code: "+t.statusCode,void r("Unknown error",null);var e=new FileReader;e.addEventListener("loadend",function(){r(null,e.result)}),e.readAsDataURL(t.response)},t.send("")},getUsersAsync:function(e,r){var t=this;t.authContext.acquireToken(t.acquireToken,function(o,n){if(o||!n)return void r("Error",null);var a=t.authContext._extractIdToken(n),s="";a&&a.hasOwnProperty("tid")&&(s=a.tid);var i=new XMLHttpRequest;i.open("GET","https://graph.windows.net/"+s+"/users?"+apiVersion+"&$filter=startswith(displayName,"+encodeURIComponent("'"+e+"') or ")+"startswith(userPrincipalName,"+encodeURIComponent("'"+e+"')"),!0),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Authorization","Bearer "+n),i.onabort=i.onerror=i.ontimeout=function(){r("Error",null)},i.onload=function(){if(401===i.status)return void r("Unauthorized",null);if(200!==i.status)return void r("Unknown error",null);var e=JSON.parse(i.responseText),o=[];return void 0!==e["odata.error"]?void r(e["odata.error"],null):(e.value.forEach(function(e){var r={};r.displayName=e.displayName,r.department=e.department,r.jobTitle=e.jobTitle,r.mail=e.mail,r.workPhone=e.telephoneNumber,r.mobile=e.mobile,r.office=e.physicalDeliveryOfficeName,r.sipAddress=e.userPrincipalName,r.alias=e.mailNickname,r.personId=e.objectId,o.push(r)}),o.length>t.maxResult&&(o=o.slice(0,t.maxResult)),void r(null,o))},i.send("")})},getUserImageAsync:function(e,r){var t=this;t.authContext.acquireToken(t.acquireToken,function(o,n){if(o||!n)return void r("Error",null);var a=t.authContext._extractIdToken(n),s="";a&&a.hasOwnProperty("tid")&&(s=a.tid);var i=new XMLHttpRequest;i.open("GET","https://graph.windows.net/"+s+"/users/"+e+"/thumbnailPhoto?"+apiVersion),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Authorization","Bearer "+n),i.responseType="blob",i.onabort=i.onerror=i.ontimeout=function(){r("Error",null)},i.onload=function(){if(401===i.status)return void r("Unauthorized",null);if(200!==i.status)return void r("Unknown error",null);var e=new FileReader;e.addEventListener("loadend",function(){r(null,e.result)}),e.readAsDataURL(i.response)},i.send("")})}}}();
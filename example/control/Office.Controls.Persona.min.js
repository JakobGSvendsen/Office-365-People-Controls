!function(){"use strict";window.Type&&window.Type.registerNamespace?Type.registerNamespace("Office.Controls"):(void 0===window.Office&&(window.Office={},window.Office.namespace=!0),void 0===window.Office.Controls&&(window.Office.Controls={},window.Office.Controls.namespace=!0)),Office.Controls.Persona=function(e,o,n,t){return"object"!=typeof e||"object"!=typeof n||Office.Controls.Utils.isNullOrUndefined(o)?void Office.Controls.Utils.errorConsole("Invalid parameters type"):(this.root=e,this.templateID=o,this.personaObject=n,void(this.isHidden=t))},Office.Controls.Persona.prototype={onError:null,rootNode:null,mainNode:null,actionNodes:null,actionDetailNodes:null,oriID:"",get_rootNode:function(){return this.rootNode},get_mainNode:function(){return this.mainNode},get_actionNodes:function(){return this.actionNodes},get_actionDetailNodes:function(){return this.actionDetailNodes},loadTemplateAsync:function(e,o){var n=this,t=Office.Controls.Persona.PersonaHelper.getCachedTemplate(e);if(null!==t)return n.parseTemplate(t),void o(n.rootNode,null);var r=new XMLHttpRequest;r.open("GET",e,!0),r.onreadystatechange=function(){if(4===this.readyState){if(200!==this.status)return void o(null,"Unknown error");var t,r;window.DOMParser?(t=new DOMParser,r=t.parseFromString(this.responseText,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async=!1,r.loadXML(this.responseText)),Office.Controls.Persona.PersonaHelper.setCachedTemplate(e,r),n.parseTemplate(r),o(n.rootNode,null)}},r.send()},parseTemplate:function(e){try{var o=e.getElementById(this.templateID),n=document.createElement("div");if(this.hiddenNode(n,this.isHidden),n.innerHTML=this.bindData(o.innerHTML),Office.Controls.Utils.isNullOrUndefined(n))return void Office.Controls.Utils.errorConsole("Fail to get persona document");if(this.root.appendChild(n),this.rootNode=n,this.mainNode=n.getElementsByClassName(Office.Controls.PersonaConstants.SectionTag_Main),null===this.mainNode)this.mainNode=this.rootNode;else if(this.actionNodes=n.getElementsByClassName(Office.Controls.PersonaConstants.SectionTag_Action),null!==this.actionNodes){this.actionDetailNodes=n.getElementsByClassName(Office.Controls.PersonaConstants.SectionTag_ActionDetail);for(var t=null,r=this,s=0;s<r.actionNodes.length;s++)null!==r.actionNodes[s]&&(t=r.actionNodes[s],Office.Controls.Utils.addEventListener(t,"click",function(e){r.setActiveStyle(event)}))}}catch(i){throw i}},bindData:function(e){for(var o,n,t=/\$\{([^\}\{]+)\}/g,r=e,s=r.match(t),i=this,a=0;a<s.length;a++)o=s[a].substring(2,s[a].length-1),n=i.getValueFromJSONObject(o),r=r.replace(s[a],n);return r},getValueFromJSONObject:function(e){return Office.Controls.Utils.getObjectFromJSONObjectName(this.personaObject,e)},hiddenNode:function(e,o){o?(e.style.visibility="",e.style.display=""):(e.style.visibility="hidden",e.style.display="none")},removeDetailCard:function(){},setActiveStyle:function(e){for(var o=e||window.event,n=o.currentTarget,t="is-active",r=n.getAttribute("child"),s=0;s<this.actionNodes.length;s++)n===this.actionNodes[s]?this.oriID!==r?(Office.Controls.Utils.addClass(this.actionNodes[s],t),this.oriID=r):(this.oriID="",Office.Controls.Utils.removeClass(this.actionNodes[s],t)):Office.Controls.Utils.removeClass(this.actionNodes[s],t);for(var s=0;s<this.actionDetailNodes.length;s++)Office.Controls.Utils.containClass(this.actionDetailNodes[s],r)&&this.oriID===r?Office.Controls.Utils.addClass(this.actionDetailNodes[s],t):Office.Controls.Utils.removeClass(this.actionDetailNodes[s],t)}},Office.Controls.Persona.PersonaHelper=function(){},Office.Controls.Persona.PersonaHelper.createPersona=function(e,o,n,t,r,s){var i=new Office.Controls.Persona(e,n,t,r);i.loadTemplateAsync(o,s)},Office.Controls.Persona.PersonaHelper.createInlinePersona=function(e,o,n,t){var r=null,s=!0,i=new Office.Controls.Persona(e,Office.Controls.Persona.PersonaHelper.getPersonaType().NameImage,n,!0);return i.loadTemplateAsync(o,function(o,i){"click"===t&&(null!==o?Office.Controls.Utils.addEventListener(o,t,function(o){null==r?(r=new Office.Controls.Persona(e,Office.Controls.Persona.PersonaHelper.getPersonaType().PersonaCard,n,!0),r.loadTemplateAsync(tempPath,function(e,o){s=!1})):(r.hiddenNode(r.get_rootNode(),s),s=s?!1:!0)}):Office.Controls.Utils.errorConsole("Wrong template path"))}),i},Office.Controls.Persona.PersonaHelper.createPersonaCard=function(e,o,n,t){return Office.Controls.Persona.PersonaHelper.createPersona(e,o,Office.Controls.Persona.PersonaHelper.getPersonaType().PersonaCard,n,!0,t)},Office.Controls.Persona.PersonaHelper.createPersonaCard=function(e,o,n,t){return Office.Controls.Persona.PersonaHelper.createPersona(e,o,Office.Controls.Persona.PersonaHelper.getPersonaType().PersonaCard,n,!0,t)},Office.Controls.Persona.PersonaHelper.convertAadUserToPersonaObject=function(e){if("object"!=typeof e||Office.Controls.Utils.isNullOrUndefined(e))return void Office.Controls.Utils.errorConsole("AAD user data is null.");var o={};return o.Id=e.personId,o.Main={},o.Main.ImageUrl="",o.Main.PrimaryText=e.displayName,o.Main.SecondaryText=e.jobTitle+","+e.department,o.Main.TertiaryText=e.office,o.Action={},o.Action.Email={},o.Action.Email.Protocol="mailto:",o.Action.Email.Work={},o.Action.Email.Work.Lable="Work:",o.Action.Email.Work.Value=e.mail,o.Action.Phone={},o.Action.Phone.Protocol="tel:",o.Action.Phone.Work={},o.Action.Phone.Work.Lable="Work:",o.Action.Phone.Work.Value=e.workPhone,o.Action.Phone.Mobile={},o.Action.Phone.Mobile.Lable="Mobile:",o.Action.Phone.Mobile.Value=e.mobile,o.Action.Chat={},o.Action.Chat.Protocol="sip:",o.Action.Chat.Skype={},o.Action.Chat.Skype.Lable="Skype:",o.Action.Chat.Skype.Value=e.sipAddress,o},Office.Controls.Persona.PersonaHelper.convertAadUsersToPersonaObjects=function(e){if("object"!=typeof e||Office.Controls.Utils.isNullOrUndefined(e))return void Office.Controls.Utils.errorConsole("AAD user collection is null.");var o=[];return e.forEach(function(e){o.push(Office.Controls.Persona.PersonaHelper.convertAadUserToPersonaObject(e))}),o},Office.Controls.Persona.PersonaHelper.getCachedTemplate=function(e){if(""===e||Office.Controls.Utils.isNullOrUndefined(e))return void Office.Controls.Utils.errorConsole("Wrong template path");var o=e.toLowerCase(),n=Office.Controls.Persona.PersonaHelper._cachedTemplates[o];return Office.Controls.Utils.isNullOrUndefined(n)?null:n},Office.Controls.Persona.PersonaHelper.setCachedTemplate=function(e,o){if(""===e||Office.Controls.Utils.isNullOrUndefined(e))return void Office.Controls.Utils.errorConsole("Wrong template path");if("object"!=typeof o||Office.Controls.Utils.isNullOrUndefined(o))return void Office.Controls.Utils.errorConsole("Invalid template document");var n=e.toLowerCase();Office.Controls.Persona.PersonaHelper._cachedTemplates[n]=o},Office.Controls.Persona.PersonaHelper.getPersonaType=function(){var e={NameOnly:"nameonly",NameImage:"nameimage",DetailCard:"detailcard",PersonaCard:"personacard"};return e},Office.Controls.Persona.ImageSize=function(){},Office.Controls.Persona.ImageSize.prototype={s:0,m:1,l:2},Office.Controls.Persona.StringUtils=function(){},Office.Controls.Persona.StringUtils.getDisplayText=function(e,o,n){return e?(Office.Controls.Persona.StringUtils._propertyDisplayConfiguration&&Office.Controls.Persona.StringUtils._currentPersonaType===o||(Office.Controls.Persona.StringUtils._propertyDisplayConfiguration=Office.Controls.Persona.StringUtils._loadLengthConfiguration(o),Office.Controls.Persona.StringUtils._currentPersonaType=o),Office.Controls.Persona.StringUtils._propertyDisplayConfiguration.length&&e.length>Office.Controls.Persona.StringUtils._propertyDisplayConfiguration[n]?e.substr(0,Office.Controls.Persona.StringUtils._propertyDisplayConfiguration[n])+"...":e):""},Office.Controls.Persona.StringUtils._loadLengthConfiguration=function(e){var o;switch(e){case 1:o=Office.Controls.Persona.StringUtils._propertyDisplayConfiguration=[18,26,40,42];break;case 0:case 4:o=Office.Controls.Persona.StringUtils._propertyDisplayConfiguration=Office.Controls.Utils.isIE()||Office.Controls.Utils.isFirefox()?[30,0,40,42]:[27,0,40,42];break;default:o=null}return o},Office.Controls.Persona.Strings=function(){},Office.Controls.PersonaResources=function(){},Office.Controls.PersonaConstants=function(){},Office.Controls.Persona.registerClass&&Office.Controls.Persona.registerClass("Office.Controls.Persona"),Office.Controls.Persona.Strings.registerClass&&Office.Controls.Persona.Strings.registerClass("Office.Controls.Persona.Strings"),Office.Controls.PersonaConstants.registerClass&&Office.Controls.PersonaConstants.registerClass("Office.Controls.PersonaConstants"),Office.Controls.PersonaResources.registerClass&&Office.Controls.PersonaResources.registerClass("Office.Controls.PersonaResources"),Office.Controls.Persona.PersonaHelper.registerClass&&Office.Controls.Persona.PersonaHelper.registerClass("Office.Controls.Persona.PersonaHelper"),Office.Controls.Persona.StringUtils.registerClass&&Office.Controls.Persona.StringUtils.registerClass("Office.Controls.Persona.StringUtils"),Office.Controls.PersonaResources.PersonaName="Persona",Office.Controls.Persona.Strings.emailString="Email",Office.Controls.Persona.Strings.lyncMessageString="IM",Office.Controls.Persona.Strings.phoneString="Phone",Office.Controls.Persona.Strings.mobileString="Mobile",Office.Controls.Persona.Strings.workPhoneString="Work",Office.Controls.Persona.Strings.colonString=":",Office.Controls.Persona.Strings.suspensionPoints="...",Office.Controls.Persona.StringUtils._propertyDisplayConfiguration=null,Office.Controls.Persona.StringUtils._currentPersonaType=0,Office.Controls.Persona.PersonaHelper._cachedTemplates={},Office.Controls.PersonaConstants.SectionTag_Main="persona-section-tag-main",Office.Controls.PersonaConstants.SectionTag_Action="ms-PersonaCard-action",Office.Controls.PersonaConstants.SectionTag_ActionDetail="ms-PersonaCard-actionDetails"}();
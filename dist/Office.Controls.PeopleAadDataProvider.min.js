!function(){"use strict";window.Type&&window.Type.registerNamespace?Type.registerNamespace("Office.Controls"):(void 0===window.Office&&(window.Office={},window.Office.namespace=!0),void 0===window.Office.Controls&&(window.Office.Controls={},window.Office.Controls.namespace=!0)),Office.Controls.PeopleAadDataProvider=function(){},Office.Controls.PeopleAadDataProvider.prototype={maxResult:50,authContext:null,lastErrorMessage:null,severHost:"localhost:3000",acquireToken:"00000002-0000-0000-c000-000000000000",apiVersion:"api-version=1.5",getPrincipals:function(e,r){var o=new XMLHttpRequest,t=this;o.open("GET","http://"+this.serverHost+"/api?keyword="+encodeURIComponent(e),!0),o.setRequestHeader("Content-Type","application/json"),o.withCredentials=!0,o.onabort=o.onerror=o.ontimeout=function(){t.lastErrorMessage="Search error. Try login first.",r("Error",null)},o.onload=function(){if(401===o.status)return t.lastErrorMessage="Unauthorized. You need login first.",void r("Unauthorized",null);200!==o.status&&(t.lastErrorMessage="Unknown error. Status code: "+o.statusCode,r("Unknown error",null));var e=JSON.parse(o.responseText),n=[];return void 0!==e["odata.error"]?(t.lastErrorMessage="Server error: "+e["odata.error"].message.value,void r(e["odata.error"],null)):(e.value.forEach(function(e){var r={};r.displayName=e.displayName,r.department=e.department,r.jobTitle=e.jobTitle,r.mail=e.mail,r.workPhone=e.telephoneNumber,r.mobile=e.mobile,r.office=e.physicalDeliveryOfficeName,r.sipAddress=e.userPrincipalName,r.alias=e.mailNickname,r.personId=e.objectId,n.push(r)}),n.length>t.maxResult&&(n=n.slice(0,t.maxResult)),void r(null,n))},o.send("")},getUsersAsync:function(e,r){var o=this;o.authContext.acquireToken(o.acquireToken,function(t,n){if(t||!n)return void r("Error",null);var a=o.authContext._extractIdToken(n),i="";a&&a.hasOwnProperty("tid")&&(i=a.tid);var s=new XMLHttpRequest;s.open("GET","https://graph.windows.net/"+i+"/users?"+apiVersion+"&$filter=startswith(displayName,"+encodeURIComponent("'"+e+"') or ")+"startswith(userPrincipalName,"+encodeURIComponent("'"+e+"')"),!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Authorization","Bearer "+n),s.onabort=s.onerror=s.ontimeout=function(){r("Error",null)},s.onload=function(){if(401===s.status)return void r("Unauthorized",null);if(200!==s.status)return void r("Unknown error",null);var e=JSON.parse(s.responseText),t=[];return void 0!==e["odata.error"]?void r(e["odata.error"],null):(e.value.forEach(function(e){var r={};r.displayName=e.displayName,r.department=e.department,r.jobTitle=e.jobTitle,r.mail=e.mail,r.workPhone=e.telephoneNumber,r.mobile=e.mobile,r.office=e.physicalDeliveryOfficeName,r.sipAddress=e.userPrincipalName,r.alias=e.mailNickname,r.personId=e.objectId,t.push(r)}),t.length>o.maxResult&&(t=t.slice(0,o.maxResult)),void r(null,t))},s.send("")})},getUserImageAsync:function(e,r){var o=this;o.authContext.acquireToken(o.acquireToken,function(t,n){if(t||!n)return void r("Error",null);var a=o.authContext._extractIdToken(n),i="";a&&a.hasOwnProperty("tid")&&(i=a.tid);var s=new XMLHttpRequest;s.open("GET","https://graph.windows.net/"+i+"/users/"+e+"/thumbnailPhoto?"+apiVersion),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Authorization","Bearer "+n),s.responseType="blob",s.onabort=s.onerror=s.ontimeout=function(){r("Error",null)},s.onload=function(){if(401===s.status)return void r("Unauthorized",null);if(200!==s.status)return void r("Unknown error",null);var e=new FileReader;e.addEventListener("loadend",function(){r(null,e.result)}),e.readAsDataURL(s.response)},s.send("")})}}}();
<!DOCTYPE html>
<html>
<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
    <title>PeoplePicker Playground</title>
    <style type="text/css">
        td.ppcontainer {
            border: 1px solid black;
            width: 200px;
        }
    </style>
</head>
<body>

    <script type="text/javascript" src="https://ajax.microsoft.com/ajax/4.0/MicrosoftAjax.debug.js"></script>
    <script type="text/javascript" src="Office.Controls.PeoplePicker.js"></script>
    <script type="text/javascript" src="DataProvider.js"></script>
    <script type="text/javascript" src="AadDataProvider.js"></script>
    <link rel="stylesheet" type="text/css" href="PeoplePickerWholeStyle.css">

    <h1>PeoplePicker</h1>

    <table style="width: 100%; border: 0px">
        <tr>
            <td>
                <!-- Links -->
                <div>
                    <h3>Links</h3>
                    <p><a href="devex.html">Instructions</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="TestPage.html">Test Cases</a></p>
                </div>

                <!-- Known Issues -->
                <div>
                    <h3>Known Issues</h3>
                    <ul>
                        <li>Icons are not final.</li>
                        <li>Recommend to use <b style="color: #0000EE">InPrivate</b> browsing.</li>
                        <li>Need <b style="color: #0000EE">login</b> first otherwise you'll get error with AadDataProvider.</li>
                    </ul>
                </div>

                <!-- Playground -->
                <div>
                    <h3>Playground</h3>
                    <p><u>Mock data:</u><div id='ppc_mock'></div></p>
                    <p><u>AAD data:</u></p>
                    &nbsp;&nbsp;&nbsp;&nbsp;<a id="login_user">Login</a>
                    <table>
                        <tr>
                            <td>Single Selection</td>
                            <td class="ppcontainer"><div id='ppc_single'></div></td>
                        </tr>
                        <tr>
                            <td>Multiple Selection</td>
                            <td class="ppcontainer">
                                <div id='ppc_multiple'></div>
                                <div id='ppc_multiple_error' style="color: red"></div>
                                <div id='ppc_multiple_people' style="color: blue"></div>
                            </td>
                        </tr>
                    </table>
                </div>
            </td>
            <td style="text-align:right; vertical-align:top">
                <h3>Demo Tenant and Users</h3>
                <table style="border: 1px solid black; margin-left:auto; margin-right:0">
                    <thead><b>***REMOVED***</b></thead>
                    <tr>
                        <th>Display Name</th>
                        <th>Account</th>
                        <th>Password</th>
                    </tr>
                    <tr>
                        <td>***REMOVED***</td>
                        <td>***REMOVED***</td>
                        ***REMOVED***
                    </tr>
                    <tr>
                        <td>***REMOVED***</td>
                        <td>***REMOVED***</td>
                        ***REMOVED***
                    </tr>
                    <tr>
                        <td>***REMOVED***</td>
                        <td>***REMOVED***</td>
                        ***REMOVED***
                    </tr>
                </table>
                <p/>
                <table style="border: 1px solid black; margin-left:auto; margin-right:0">
                    <thead><b>Tenant: yamplat.onmicrosoft.com</b></thead>
                    <tr>
                        <th>Display Name</th>
                        <th>Account</th>
                        <th>Password</th>
                    </tr>
                    <tr>
                        <td>Yihua Cao</td>
                        <td>***REMOVED***</td>
                        ***REMOVED***
                    </tr>
                    <tr>
                        <td>***REMOVED***</td>
                        <td>***REMOVED***</td>
                        ***REMOVED***
                    </tr>
                    <tr>
                        <td>***REMOVED***</td>
                        <td>***REMOVED***</td>
                    </tr>
                </table>
                <h3>Other Tenant</h3>
                <p>Please do <b><a id="login_admin">Admin Consent</a></b> with a <b style="color: #0000EE">Admin</b> account first.</p>
            </td>
        </tr>
    </table>
    

    <script type="text/javascript">
        var serverHost = 'yihcaow1001:3000';
        if (window.location.href.indexOf('azurewebsites.net') != -1) {
            serverHost = '***REMOVED***';
        }
        var pageUri = window.location.href;

        document.getElementById('login_user').href = 'http://' + serverHost + '/authcode?redirect_uri=' + pageUri;
        document.getElementById('login_admin').href = 'http://' + serverHost + '/authcode?userType=admin&redirect_uri=' + pageUri;

        // Mock data

        var mockDataProvider = Object.create(MockDataProvider);
        new Office.Controls.PeoplePicker(document.getElementById('ppc_mock'), mockDataProvider, {});

        // AAD data

        var aadDataProvider = new AadDataProvider();
        aadDataProvider.serverHost = serverHost;

        params = new Object();
        params.allowMultipleSelections = false;
        params.enableCache = true;
        params.showValidationErrors = true;
        new Office.Controls.PeoplePicker(document.getElementById('ppc_single'), aadDataProvider, params);

        params.allowMultipleSelections = true;
        params.startSearchCharLength = 1;
        params.inputHint = "Try to select multiple records...";
        params.showValidationErrors = false;
        params.onError = function (control, validationError) {
            if (validationError.errorName == 'ServerProblem') {
                document.getElementById('ppc_multiple_error').innerHTML = "<pre>" + aadDataProvider.lastErrorMessage + "</pre>";
            } else {
                document.getElementById('ppc_multiple_error').innerHTML = "<pre>" + validationError.localizedErrorMessage + "</pre>";
            }
        };
        params.onAdded = params.onRemoved = function (control) {
            var people = 'Added people: ';
            control.getAddedPeople().forEach(
                function (e) {
                    people += '<p>{' + e.DisplayName + ', id=' + e.PersonId + '}</p>';
                });
            document.getElementById('ppc_multiple_people').innerHTML = "<pre>" + people + "</pre>";
        }
        new Office.Controls.PeoplePicker(document.getElementById('ppc_multiple'), aadDataProvider, params);

    </script>
</body>
</html>
